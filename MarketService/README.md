# Сервис маркета
Здесь представлена реализация маркета.

## Что реализовано:
1) Добавлена CRUD логика продуктов и категорий;
2) Написана и протестирована логика взаимосвязи продуктов и категорий (добавление категорий продукту, удаление категории из продукта);
3) Реализована логика регистрации и входа пользователя по токенам;
4) На эндпоинты с созданием, удалением и обновлением объекта стоит фильтр. Доступ к этим эндпоинтам имеет только пользователь с ролью админа;
5) На все сервисы (кроме TokenService) и контроллеры написаны модульные и интеграционные тесты;
6) Добавлена swagger документация;
7) Настроен CI/CD для проверки работы сервиса во время push. На данный момент только две джобы: сбор приложения и запуск тестов;
8) Приложение можно собрать и запустить в докере;
9) Написана и протестирована логика работы с заказами (просмотр всех заказов пользователя, просмотр заказа по его номеру, управление товарами внутри заказа и оплата);
10) Подключен debezium (на данный момент все логи отображаются внутри приложения).

## Документация
Список всех эндпоинтов: http://localhost:8080/api/v2/swagger-ui/index.html.

## Возможные проблемы при запуске
- Если вы счастливый обладатель windows, то сервис маркета может не запуститься. Если контейнер не поднялся, тогда необходимо в папке основного проекта поменять переменную окружающей среды (в файле .env) MARKET_DATABASE_HOST на ip-адрес wsl. Узнать ip-адрес можно по команде:
    ```
    ipconfig
    ```
  > ip-адрес может меняться при повторном включении устройства, поэтому периодически проверяйте адрес.
- При запуске интеграционных тестов используется testcontainers. Некоторые системы UNIX не дают разрешения на создание контейнера сторонним папкам. Позаботьтесь о предоставлении папке market нужных прав, если тесты не проходят.

## Запуск тестов
Для запуска тестов необходимо на устройстве иметь JDK и maven (версии были описаны в [главном readme](../README.md)). Далее запустить команду:
```
mvn test
```
В приложении подключен jacoco, поэтому при желании можно посмотреть репорт в папке target.

## План действий:
Теперь осталось подключить Kafka (скорее всего, станет частью дипломной работы).
Далее следуют небольшие поправки, которые стоит добавить в проект, но не являются первой необходимостью:
- Добавить дефолтные сообщения об ошибке при валидации входных данных запросов + добавить соответствующие тесты;
- Добавить Clock Configuration, а затем обновить тесты, где используется Instant;
- Добавить UUID генератор первичных ключей для заказов;
- Настроить исключение таблиц для debezuim;
- Создать scheduled tasks для удаления старых заказов и для проверки неоплаченных заказов на согласованное с базой данных количество продуктов.